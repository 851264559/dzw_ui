<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>结算中心</title>
		<style>
			.clientCente {
				background-color: #fafafa;
			}
			
			h1 {
				font-size: 25px;
			}
			
			.sum_danhao {
				width: 300px;
			}
			
			#summaryApp {
				zoom: 0.8;
			}
		</style>
		<!--<link rel="stylesheet" href="../../css/element.css">-->
	</head>

	<body>
		<div id="summaryApp">
			<div class="sum_title">
				<el-row>
					<el-col :span="24">
						<span style="font-size: 26px;">结算中心</span>
					</el-col>
				</el-row>
			</div>
			<div>
				<el-row>
					<el-col :span="8">
						&nbsp;
					</el-col>
					<el-col :span="12">
						结算状态：
						<el-select :popper-append-to-body="false" @change="tiaojianCx()" v-model="value" style="width: 160px;" placeholder="请选择">
							<el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
							</el-option>
						</el-select>
					</el-col>
					<el-dialog title="提示" :visible.sync="dialogVisible" width="30%" :before-close="handleCloses1">
						<el-form :model="updateClientData" label-width="100px" class="demo-ruleForm" label-position="left">
							<el-row>
								<el-col :span="3">&nbsp;</el-col>
								<el-col :span="21">
									<h2>
										<span style="color: red;">
											应收金额：
										</span>
										<span style="text-decoration:underline;color: blue;">
											{{clearingMoney}}
										</span>
									</h2>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item>
										<el-button type="primary" @click="jsSubmitForm('已结算')">立即结算</el-button>
										<el-button @click="dialogVisible = false">关闭</el-button>
									</el-form-item>
								</el-col>
							</el-row>
						</el-form>
						<!--<span slot="footer" class="dialog-footer">
						    <el-button @click="dialogVisible = false">取 消</el-button>
						    <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
  						</span>-->
					</el-dialog>
					<el-col :span="4">
						<el-button type="primary" v-if="jiesuanBtn" @click="settleAccounts2">结算</el-button>
						<el-button type="primary" v-else @click="settleAccounts">回滚</el-button>
					</el-col>
				</el-row>
				<br />
				<el-row :span="24">
					<el-table ref="closeanaccount" :border="true" :data="closeanaccount" highlight-current-row @current-change="addCloseanaccount" max-height="600" style="width: 100%">
						<el-table-column type="index" label="序号" width="150">
						</el-table-column>
						<el-table-column property="saleno" label="销售单号" width="200">
						</el-table-column>
						<el-table-column property="zhuangtai" label="单据类型" width="200">
						</el-table-column>
						<el-table-column property="receiptstype" label="单据类型" width="200">
						</el-table-column>
						<el-table-column property="clearing" label="结算方式" width="200">
						</el-table-column>
						<el-table-column property="clearingmoney" label="结算金额" width="200">
						</el-table-column>
						<el-table-column property="principal" label="负责人" width="200">
						</el-table-column>
						<el-table-column property="license" label="车牌号" width="200">
						</el-table-column>
						<el-table-column property="customername" label="客户名称" width="200">
						</el-table-column>
						<el-table-column property="frameno" label="车架号" width="200">
						</el-table-column>
						<el-table-column property="vehiclemodel" label="车型" width="200">
						</el-table-column>
						<el-table-column property="timeofcompletion" label="完工时间" width="200">
						</el-table-column>
					</el-table>
				</el-row>
				<el-row>
					<el-col :span="20">
						&nbsp;
					</el-col>
					<el-col :span="4">

					</el-col>
				</el-row>
			</div>
		</div>
	</body>
	<!--<script type="text/javascript" src="../../js/vue.js"></script>
	<script type="text/javascript" src="../../js/element.js"></script>
	<script type="text/javascript" src="../../js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="../../js/left.js"></script>
	<script type="text/javascript" src="../../js/axios_cfg.js"></script>
	<script type="text/javascript" src="../../js/axios.min.js"></script>
	<script type="text/javascript" src="../../js/echarts.min.js"></script>-->
	<script>
		const summaryApp = new Vue({
			el: '#summaryApp',
			data: {
				input3: '',
				value1: '',
				checkedJs: true,
				closeanaccount: [],
				//				{
				//					id: 'id',
				//					saleNo: '销售单号',
				//					receiptsType: '单据类型',
				//					clearing: '结算方式',
				//					clearingMoney: '结算金额',
				//					principal: '负责人',
				//					license: '车牌号',
				//					customerName: '客户名称',
				//					frameNo: '车架号',
				//					vehicleModel: '车型',
				//					timeOfCompletion: '完工时间'
				//				}
				dialogVisible: false,
				jiesuan: {},
				clearingMoney: 0,
				updateClientData: {
					aa: "",
				},
				options: [{
					value: '待结算',
					label: '待结算'
				}, {
					value: '已结算',
					label: '已结算',
				}],
				jiesuanBtn: true,
				value: '待结算'
			},
			methods: {
				aa() {
					alert(1)
				},
				addCloseanaccount(data) {
					if(data.clearingmoney!=null&&data.clearingmoney!=0){
						this.clearingMoney=data.clearingmoney
					}else{
						this.clearingMoney=0
					}
					
					this.jiesuan = data
				},
				tiaojianCx() {
					this.showList()
					if(this.value == "待结算") {
						this.jiesuanBtn = true
					} else {
						this.jiesuanBtn = false
					}

				},
				jsSubmitForm(js) {
					let _this = this
					this.jiesuan.zhuangtai = js;
					axios.put(`http://127.0.0.1:8080/dzw_sys/api/dzw_Sys/cwl/closeanaccount/update`, this.jiesuan).then(function(resp) {
						if(resp.data) {
							if(js = "已结算") {
								_this.$message({
									message: '结算成功！',
									type: 'success'
								});
								_this.dialogVisible=false;
							} else {
								_this.$message({
									message: '回滚成功！',
									type: 'success'
								});
							}
							_this.showList()
							_this.clearingMoney=0
						}
					})
				},
				handleCloses1(done) {
					this.$confirm('确认关闭？')
						.then(_ => {
							done();
						})
						.catch(_ => {});
				},
				settleAccounts() {
					if(JSON.stringify(this.jiesuan) != "{}") {
							this.jsSubmitForm("待结算")
					} else {
							this.$message('请选择要回滚的单！');
					}

				},
				settleAccounts2() {
					if(JSON.stringify(this.jiesuan) != "{}") {
							this.dialogVisible = true
					} else {
							this.$message('请选择要结算的单！');
					}

				}
				,
				deleteRow(index, rows) {
					rows.splice(index, 1);
				},
				handleCurrentChange(ss) {
					
				},
				showList() {
					let _this = this
					axios.get(`http://127.0.0.1:8080/dzw_sys/api/dzw_Sys/cwl/closeanaccount/selectAll/${this.value}`).then(function(resp) {
						_this.closeanaccount = resp.data
					})
				}
			},
			mounted() {
				this.showList()
			}
		})
	</script>

</html>