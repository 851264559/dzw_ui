<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<style>
			#clientApp {
				zoom: 0.8;
			}
			
			.clientCente {
				background-color: #fafafa;
			}
		</style>
		<link rel="stylesheet" href="../../css/element.css">
	</head>

	<body>
		<div id="clientApp">
			<div>
				<el-row>
					<br>
					<el-col :span="4">
						<div class="grid-content bg-purple-dark">
							<span style="font-size: 25px;">客户档案</span>
						</div>
					</el-col>
					<el-col :span="5">
						<div class="grid-content bg-purple-dark">
							&nbsp;
						</div>
					</el-col>
					<el-col :span="8">
						<div class="grid-content bg-purple-dark">
							<el-input placeholder="匹配名称/名称简码/手机/会员卡号/车牌号" v-model="input3" class="input-with-select">
							</el-input>
						</div>
					</el-col>
					<el-col :span="1">
						<div class="grid-content bg-purple-dark">
							&nbsp;
						</div>
					</el-col>
					<el-col :span="6">
						<div class="grid-content bg-purple-dark">
							<el-button @click="aa" type="primary" icon="el-icon-search">查询</el-button>
							&nbsp;
							<el-button type="success" @click="addDialog" icon="el-icon-plus">添加</el-button>
							&nbsp;
							<el-button type="info">关闭</el-button>
						</div>
					</el-col>
				</el-row>
			</div>
			<div>
				<el-dialog title="用户添加" :visible.sync="dialogVisible" width="60%" :before-close="handleClose">
					<div id="addClient">
						<el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
							<el-row>
								<el-col :span="8">
									<el-form-item label="客户编号" prop="cId">
										<el-input v-model="ruleForm.cId" disabled></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="客户名称" prop="cName">
										<el-input v-model="ruleForm.cName"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="联系人" prop="linkman">
										<el-input v-model="ruleForm.linkman"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="手机" prop="phone">
										<el-input v-model="ruleForm.phone"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="用户类别" prop="userType">
										<el-select v-model="ruleForm.userType" :popper-append-to-body="false" clearable placeholder="请选择">
											<el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="详细地址" prop="detailedAddress">
										<el-input v-model="ruleForm.detailedAddress"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item label="备注" prop="remark">
										<el-input type="textarea" v-model="ruleForm.remark"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">&nbsp;</el-col>
								<el-col :span="8">
									<el-form-item>
										<el-button type="primary" @click="submitForm('ruleForm')">立即创建</el-button>
										<el-button @click="resetForm('ruleForm')">重置</el-button>
									</el-form-item>
								</el-col>
								<el-col :span="8">&nbsp;</el-col>
							</el-row>
						</el-form>
					</div>
				</el-dialog>
			</div>
			<div>
				<el-dialog title="用户修改" :visible.sync="dialogVisible2" width="60%" :before-close="handleClose">
					<div id="addClient">
						<el-form :model="updateClientData" :rules="rules2" ref="updateClientData" label-width="100px" class="demo-ruleForm">
							<el-row>
								<el-col :span="8">
									<el-form-item label="客户编号" prop="cid">
										<el-input v-model="updateClientData.cid" disabled></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="客户名称" prop="cname">
										<el-input v-model="updateClientData.cname"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="联系人" prop="linkman">
										<el-input v-model="updateClientData.linkman"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="手机" prop="phone">
										<el-input v-model="updateClientData.phone"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="用户类别" prop="usertype">
										<el-select v-model="updateClientData.usertype" :popper-append-to-body="false" clearable placeholder="请选择">
											<el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="详细地址" prop="detailedaddress">
										<el-input v-model="updateClientData.detailedAddress"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item label="备注" prop="remark">
										<el-input type="textarea" v-model="updateClientData.remark"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">&nbsp;</el-col>
								<el-col :span="8">
									<el-form-item>
										<el-button type="primary" @click="updateSubmitForm('updateClientData')">立即更新</el-button>
										<el-button @click="resetForm('updateClientData')">重置</el-button>
									</el-form-item>
								</el-col>
								<el-col :span="8">&nbsp;</el-col>
							</el-row>
						</el-form>
					</div>
				</el-dialog>
			</div>
			<br>
			<br>
			<div class="clientCente">
				<el-row>
					<el-col :span="24">
						<el-table :data="client_Client" :border="true" highlight-current-row @current-change="client_handleCurrentChange" style="width: 100%" height="310px" max-height="310">
							<el-table-column type="index" label="序号" width="150">
							</el-table-column>
							<el-table-column prop="cid" label="客户编号" width="200">
							</el-table-column>
							<el-table-column prop="cname" label="客户名称" width="200">
							</el-table-column>
							<el-table-column prop="detailedaddress" label="详细地址" width="200">
							</el-table-column>
							<el-table-column prop="linkman" label="联系人" width="200">
							</el-table-column>
							<el-table-column prop="phone" label="手机" width="200">
							</el-table-column>
							<el-table-column prop="usertype" label="用户类别" width="200">
							</el-table-column>
							<el-table-column prop="cardno" label="会员卡号" width="200">
							</el-table-column>
							<el-table-column prop="admissiondate" label="入会日期" width="200">
							</el-table-column>
							<el-table-column prop="expiredate" label="会员到期" width="200">
							</el-table-column>
							<el-table-column prop="remark" label="备注" width="200">
							</el-table-column>
							<el-table-column prop="nowdate" label="建档日期" width="200">
							</el-table-column>
							<el-table-column prop="integral" label="积分" width="200">
							</el-table-column>
							<el-table-column prop="earnest" label="订金余额" width="200">
							</el-table-column>
							<el-table-column fixed="right" label="操作" width="200">
								<template slot-scope="scope">
									<el-button @click="updateClient(scope.row)" type="text" size="small">
										修改
									</el-button>
									<el-popconfirm confirm-button-text='好的' cancel-button-text='不用了' icon="el-icon-info" icon-color="red" title="这是一段内容确定删除吗？">
										<el-button slot="reference" @click="removeClient(scope.row.cid)" type="text" size="small">
											移除
										</el-button>
									</el-popconfirm>

								</template>
							</el-table-column>
						</el-table>
					</el-col>
				</el-row>
			</div>
			<br>
			<br>
			<div class="clientCente">
				<el-row>
					<el-col :span="24">
						<el-tabs v-model="activeName">
							<el-tab-pane label="车辆信息" name="first">
								<el-table :data="client_vehicles" :border="true" style="width: 100%" height="200px" max-height="200">
									<el-table-column type="index" label="序号" width="150">
									</el-table-column>
									<el-table-column prop="vid" label="车编号" width="200">
									</el-table-column>
									<el-table-column prop="clientid" label="客户编号" width="200">
									</el-table-column>
									<el-table-column prop="vehiclebrand" label="车辆品牌" width="200">
									</el-table-column>
									<el-table-column prop="model" label="车辆型号" width="200">
									</el-table-column>
									<el-table-column prop="driver" label="驾驶员" width="200">
									</el-table-column>
									<el-table-column prop="driverphone" label="驾驶员电话" width="200">
									</el-table-column>
									<el-table-column prop="vehicleownership" label="车辆归属" width="200">
									</el-table-column>
									<el-table-column prop="vin" label="车架号" width="200">
									</el-table-column>
									<el-table-column prop="enginebrand" label="发动机品牌" width="200">
									</el-table-column>
									<el-table-column prop="vehiclemodel" label="车辆年款" width="200">
									</el-table-column>
									<el-table-column prop="mileage" label="里程" width="200">
									</el-table-column>
									<el-table-column prop="load" label="载重" width="200">
									</el-table-column>
									<el-table-column prop="carseries" label="车系" width="200">
									</el-table-column>
									<el-table-column prop="buydate" label="购买日期" width="200">
									</el-table-column>
									<el-table-column prop="registereddate" label="上牌日期" width="200">
									</el-table-column>
									<el-table-column prop="citydue" label="车检到期" width="200">
									</el-table-column>
									<el-table-column prop="fueltype" label="燃油类型" width="200">
									</el-table-column>
									<el-table-column prop="member" label="会员码" width="200">
									</el-table-column>
									<el-table-column prop="zip" label="邮编" width="200">
									</el-table-column>
									<el-table-column fixed="right" label="操作" width="200">
										<template slot-scope="scope">
											<el-button @click.native.prevent="deleteRow(scope.$index, tableData)" type="text" size="small">
												修改
											</el-button>
											<el-button @click.native.prevent="deleteRow(scope.$index, tableData)" type="text" size="small">
												移除
											</el-button>
										</template>
									</el-table-column>
								</el-table>
							</el-tab-pane>
							<el-tab-pane label="历史记录" name="second">
								<el-table :data="client_Client" :border="true" style="width: 100%" max-height="200">
									<el-table-column type="index" label="ee" width="150">
									</el-table-column>
									<el-table-column prop="name" label="姓名" width="200">
									</el-table-column>
									<el-table-column prop="name" label="姓名" width="200">
									</el-table-column>
									<el-table-column prop="name" label="姓名" width="200">
									</el-table-column>
									<el-table-column prop="name" label="姓名" width="200">
									</el-table-column>
									<el-table-column prop="name" label="姓名" width="200">
									</el-table-column>
									<el-table-column prop="province" label="省份" width="200">
									</el-table-column>
									<el-table-column prop="city" label="市区" width="200">
									</el-table-column>
									<el-table-column prop="address" label="地址" width="300">
									</el-table-column>
									<el-table-column prop="zip" label="邮编" width="200">
									</el-table-column>
								</el-table>
							</el-tab-pane>
						</el-tabs>
					</el-col>
				</el-row>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../js/vue.js"></script>
	<script type="text/javascript" src="../../js/element.js"></script>
	<script type="text/javascript" src="../../js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="../../js/left.js"></script>
	<script type="text/javascript" src="../../js/axios.min.js"></script>
	<script type="text/javascript" src="../../js/axios_cfg.js"></script>

	<script type="text/javascript" src="../../js/echarts.min.js"></script>
	<script>
		const clientApp = new Vue({
			el: '#clientApp',
			data() {
				return {
					input3: '',
					activeName: 'first',
					client_Client: [],
					client_vehicles: [],
					ruleForm: {
						cId: '',
						cName: '',
						detailedAddress: '',
						linkman: '',
						phone: '',
						userType: '普通用户',
						remark: ''
					},
					options: [{
						value: '普通用户',
						label: '普通用户'
					}, {
						value: '员工',
						label: '员工'
					}, {
						value: '会员',
						label: '会员'
					}],
					value: '',
					dialogVisible: false,
					dialogVisible2: false,
					rules: {
						cId: [{
							required: true,
							message: '',
							trigger: 'change'
						}],
						cName: [{
							required: true,
							message: '请输入客户名称',
							trigger: 'change'
						}],
						linkman: [{
							required: true,
							message: '请输入联系人',
							trigger: 'change'
						}],
						phone: [{
							required: true,
							message: '请输入电话',
							trigger: 'change'
						}]
					},
					rules2: {
						cid: [{
							required: true,
							message: '',
							trigger: 'change'
						}],
						cname: [{
							required: true,
							message: '请输入客户名称',
							trigger: 'change'
						}],
						linkman: [{
							required: true,
							message: '请输入联系人',
							trigger: 'change'
						}],
						phone: [{
							required: true,
							message: '请输入电话',
							trigger: 'change'
						}]
					},
					updateClientData: {}
				}
			},
			methods: {
				aa() {
					alert(1)
				},
				updateClient(client) {
					this.updateClientData = client;
					console.log(this.updateClientData)
					this.dialogVisible2 = true
				},
				removeClient(cid) {
					let _this = this;
					this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						axios.delete("http://localhost:8080/dzw/api/client/removeClient/" + cid).then(function(resp) {
							if(resp.data) {
								_this.showClient();
								_this.client_handleCurrentChange();
								_this.$message({
									message: '删除成功！',
									type: 'success'
								});
							}
						})
					}).catch(() => {
						this.$message({
							type: 'info',
							message: '已取消删除'
						});
					});
				},
				client_handleCurrentChange(client_Client2) {
					if(client_Client2 != null) {
						this.client_vehicles = client_Client2.vehicles
					} else {
						this.client_vehicles = [];
					}

				},
				showClient() {
					let _this = this
					axios.get("http://localhost:8080/dzw/api/client/selectAll").then(function(resp) {
						_this.client_Client = resp.data
					})
				},
				submitForm(formName) {
					let _this = this;
					this.$refs[formName].validate((valid) => {
						if(valid) {
							axios.post("http://localhost:8080/dzw/api/client/add", _this.ruleForm).then(function(resp) {
								if(resp.data) {
									_this.showClient();
									_this.client_handleCurrentChange();
									_this.dialogVisible = false
									_this.$message({
										message: '新增成功！',
										type: 'success'
									});
								}
							})
						} else {
							return false;
						}
					});
				},
				updateSubmitForm(formName) {
					let _this = this;
					this.$refs[formName].validate((valid) => {
						if(valid) {
							axios.put("http://localhost:8080/dzw/api/client/updateClient", _this.updateClientData).then(function(resp) {
								if(resp.data) {
									_this.showClient();
									_this.client_handleCurrentChange();
									_this.dialogVisible2 = false
									_this.$message({
										message: '修改成功！',
										type: 'success'
									});
								} else {
									_this.$message({
										message: '修改失败！',
										type: 'error'
									});
								}
							})
						} else {
							return false;
						}
					});
				},
				resetForm(formName) {
					this.$refs[formName].resetFields();
				},
				weiYiId() {
					var s = [];
					var hexDigits = "0123456789QWERTYUIOPASDFGHJKLZXCVBNM";
					for(var i = 0; i < 10; i++) {
						s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
					}
					s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
					s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
					s[8] = s[13] = s[18] = s[23];
					var uuid = s.join("");
					return uuid;
				},
				handleClose(done) {
					this.$confirm('确认关闭？')
						.then(_ => {
							done();
						})
						.catch(_ => {});
				},
				addDialog() {
					this.ruleForm.cId = this.weiYiId()
					this.dialogVisible = true
				}
			},
			mounted() {
				this.showClient()
			}
		})
	</script>

</html>